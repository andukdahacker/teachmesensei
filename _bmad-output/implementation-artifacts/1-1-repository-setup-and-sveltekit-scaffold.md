# Story 1.1: Repository Setup & SvelteKit Scaffold

Status: done

## Story

As a developer,
I want a fully initialized SvelteKit project with all core dependencies and tooling configured,
So that I can begin building features on a consistent, well-structured foundation.

## Acceptance Criteria

**Given** the project doesn't exist yet
**When** I run the initialization sequence
**Then** a SvelteKit project is created using `npx sv create teachmesensei` with TypeScript, Tailwind, ESLint, Prettier, Vitest, Playwright
**And** `@supabase/supabase-js` and `@supabase/ssr` are installed
**And** `npx supabase init` creates `supabase/config.toml`, `migrations/`, and `seed.sql`
**And** `npx shadcn-svelte@latest init` configures the component library
**And** `svelte.config.js` uses `adapter-node`
**And** `.gitignore` includes `.env.local`, `node_modules/`, `.svelte-kit/`, `supabase/.temp/`
**And** `.env.example` contains all required environment variable placeholders
**And** the project builds successfully with `npm run build`
**And** `npm run dev` starts the development server without errors

## Prerequisites

Before starting, verify:

- [ ] Node.js **20+** installed (`node -v`) — Supabase SDK and CLI require it
- [ ] npm 10+ installed (`npm -v`)
- [ ] Docker Desktop installed and running — required for `supabase start` (local dev stack, ~7GB RAM)
- [ ] Git initialized in the working directory

## Tasks / Subtasks

- [x] Task 1: Scaffold SvelteKit project (AC: scaffold, TypeScript, Tailwind, ESLint, Prettier, Vitest, Playwright)
  - [x] 1.1 Run `npx sv create teachmesensei` selecting: SvelteKit minimal template, TypeScript, tailwindcss, eslint, prettier, vitest, playwright
  - [x] 1.2 Verify Svelte 5 runes mode is the default (NO legacy `export let` / `$:` syntax)
  - [x] 1.3 Verify Tailwind v4 is installed with `@tailwindcss/vite` plugin (NOT postcss, NOT `tailwind.config.js`)
  - [x] 1.4 Verify `app.css` uses `@import "tailwindcss"` (NOT `@tailwind base/components/utilities`)
  - [x] 1.5 Verify `src/routes/+page.svelte` exists (default landing page from scaffold)
- [x] Task 2: Install Supabase packages (AC: Supabase packages installed)
  - [x] 2.1 Run `npm install @supabase/supabase-js @supabase/ssr`
  - [x] 2.2 Verify `@supabase/supabase-js` >= 2.95.3 installed
  - [x] 2.3 Verify `@supabase/ssr` >= 0.8.0 installed
- [x] Task 3: Initialize Supabase local development (AC: Supabase init creates config/migrations/seed)
  - [x] 3.1 Run `npx supabase init`
  - [x] 3.2 Verify `supabase/config.toml`, `supabase/migrations/`, and `supabase/seed.sql` exist
- [x] Task 4: Initialize shadcn-svelte (AC: component library configured)
  - [x] 4.1 Run `npx shadcn-svelte@latest init`
  - [x] 4.2 Verify it configures for Svelte 5 + Tailwind v4 (uses OKLCH colors, `tw-animate-css`, bits-ui v2)
  - [x] 4.3 Verify `$lib/components/ui/` directory is created
- [x] Task 5: Configure adapter-node (AC: svelte.config.js uses adapter-node)
  - [x] 5.1 Install `@sveltejs/adapter-node`
  - [x] 5.2 Update `svelte.config.js` to use `adapter-node`
- [x] Task 6: Configure `.gitignore` (AC: gitignore correct)
  - [x] 6.1 Ensure `.gitignore` includes: `.env.local`, `node_modules/`, `.svelte-kit/`, `supabase/.temp/`, `build/`
- [x] Task 7: Create `.env.example` (AC: env placeholders created)
  - [x] 7.1 Create `.env.example` with all required placeholders (see Dev Notes below)
- [x] Task 8: Enforce Node.js version (AC: build/dev succeed on correct runtime)
  - [x] 8.1 Create `.nvmrc` containing `20`
  - [x] 8.2 Add `"engines": { "node": ">=20" }` to `package.json`
- [x] Task 9: Handle barrel file convention (AC: project conventions established)
  - [x] 9.1 If `src/lib/index.ts` is generated by `sv create`, empty it or remove it — project convention is direct imports, no barrel exports
- [x] Task 10: Verify build and dev server (AC: build succeeds, dev server starts)
  - [x] 10.1 Run `npm run build` — must complete without errors
  - [x] 10.2 Run `npm run dev` — must start without errors
  - [x] 10.3 Navigate to `http://localhost:5173` — default page renders

## Dev Notes

### STOP — Verify These Versions First

| Package | Minimum Version | Reason |
|---|---|---|
| Node.js | **20+** | Required by `@supabase/supabase-js` (>=2.79.0) and Supabase CLI |
| `svelte` | 5.50.0 | Runes API stable and default |
| `@sveltejs/kit` | 2.50.2 | Latest stable |
| `@sveltejs/adapter-node` | 5.5.2 | Railway deployment |
| `@supabase/supabase-js` | 2.95.3 | Requires Node 20+ |
| `@supabase/ssr` | 0.8.0 | New `getAll()`/`setAll()` cookie API |
| `shadcn-svelte` | 1.1.1 | Expects Svelte 5 + Tailwind v4 |
| `tailwindcss` | 4.1.18 | v4 — CSS-first config, no `tailwind.config.js` |
| `supabase` CLI | 2.75.5 | Local dev stack |
| `sv` CLI | 0.11.2 | Project scaffolding (replaces `create-svelte`) |

### Tailwind v4 — Breaking Changes from v3

The architecture doc's directory tree shows `tailwind.config.ts` — this file **DOES NOT EXIST in Tailwind v4**. Disregard `tailwind.config.ts` anywhere in the architecture doc's project structure. Critical differences:

- **NO `tailwind.config.js` or `tailwind.config.ts`** — configuration is done in CSS via `@theme` directive
- **NO `postcss.config.js`** — use `@tailwindcss/vite` plugin instead
- **NO `@tailwind base; @tailwind components; @tailwind utilities;`** — use `@import "tailwindcss"` in `app.css`
- **Automatic content detection** — no `content` paths needed (respects `.gitignore`)
- **Colors use OKLCH** instead of HSL
- **Animation:** `tw-animate-css` replaces `tailwindcss-animate`
- **Modern browsers only:** Safari 16.4+, Chrome 111+, Firefox 128+

The `sv create` CLI with Tailwind add-on will set this up correctly. Do NOT manually create config files.

### @supabase/ssr — Version Note Only

The `@supabase/ssr` v0.8.0+ uses a new `getAll()`/`setAll()` cookie API (replacing the old `get`/`set`/`remove` pattern). The auth client setup in `hooks.server.ts` and `+layout.ts` is NOT part of this story — it belongs to Story 2.1 (Supabase Auth Integration). This story only installs the packages. When Story 2.1 is created, ensure it uses the `getAll()`/`setAll()` pattern.

### `.env.example` Contents

```bash
# Supabase
PUBLIC_SUPABASE_URL=http://localhost:54321
PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Polar.sh (Phase 2 — Epic 9)
POLAR_ACCESS_TOKEN=your-polar-access-token
POLAR_WEBHOOK_SECRET=your-polar-webhook-secret

# Daily.co (Phase 1 — Epic 5)
DAILY_API_KEY=your-daily-api-key

# OpenAI / AI (Phase 1 — Epic 6)
OPENAI_API_KEY=your-openai-api-key

# App
PUBLIC_APP_URL=http://localhost:5173
```

### `svelte.config.js` — Target Configuration

```javascript
import adapter from '@sveltejs/adapter-node';
import { vitePreprocess } from '@sveltejs/vite-plugin-svelte';

export default {
  preprocess: vitePreprocess(),
  kit: {
    adapter: adapter()
  }
};
```

### `vite.config.ts` — Expected Configuration

```typescript
import { sveltekit } from '@sveltejs/kit/vite';
import tailwindcss from '@tailwindcss/vite';
import { defineConfig } from 'vitest/config';

export default defineConfig({
  plugins: [tailwindcss(), sveltekit()],
  test: {
    include: ['src/**/*.{test,spec}.{js,ts}']
  }
});
```

### shadcn-svelte Init — What to Expect

Running `npx shadcn-svelte@latest init` will:
- Create `$lib/components/ui/` directory structure
- Configure `components.json` (or equivalent) for Svelte 5 + Tailwind v4
- Use OKLCH color system
- Use `bits-ui` v2 as the headless UI layer
- Use `tw-animate-css` for animations (NOT `tailwindcss-animate`)

No shadcn components are installed in this story — that happens in Story 1.2.

### Project Structure After This Story

```
teachmesensei/
├── .env.example
├── .gitignore
├── .nvmrc                    # Contains "20" — enforces Node version
├── package.json              # "engines": { "node": ">=20" }
├── svelte.config.js          # adapter-node configured
├── vite.config.ts            # @tailwindcss/vite plugin (see example above)
├── tsconfig.json             # TypeScript strict mode
├── playwright.config.ts
├── src/
│   ├── app.html
│   ├── app.css               # @import "tailwindcss"
│   ├── routes/
│   │   └── +page.svelte      # Default landing page (from sv create)
│   └── lib/
│       └── components/
│           └── ui/           # shadcn-svelte initialized (empty)
├── supabase/
│   ├── config.toml
│   ├── migrations/
│   └── seed.sql
├── tests/                    # Playwright test directory (from sv create)
└── node_modules/
```

**NOTE:** The architecture doc's directory tree shows `tailwind.config.ts` and `postcss.config.js` — these DO NOT EXIST in Tailwind v4. Disregard those entries.

**What is NOT created in this story** (belongs to later stories):
- Route groups `(public)`, `(app)`, `(admin)`, `(enterprise)` → Story 1.2
- Layout shells (`AppShell`, `PublicShell`) → Story 1.2
- shadcn-svelte component installation (Button, Card, etc.) → Story 1.2
- `Dockerfile` → Story 1.3
- `/health` endpoint → Story 1.3
- `.github/workflows/ci.yml` → Story 1.4
- `tests/fixtures/roles.ts` → Story 1.4
- `package.json` dev workflow scripts (`db:start`, `test:unit`, etc.) → Story 1.4
- README with local dev setup instructions → Story 1.4
- `hooks.server.ts` auth setup → Story 2.1
- `+layout.ts` Supabase browser client → Story 2.1

### Architecture Compliance — MUST Verify After Implementation

- [ ] `adapter-node` for Railway deployment
- [ ] TypeScript strict mode enabled
- [ ] Svelte 5 runes — NO legacy `$:` or `writable()` stores
- [ ] Tailwind v4 via `@tailwindcss/vite` — NO `tailwind.config.js` or `tailwind.config.ts`
- [ ] `@supabase/ssr` 0.8.0+ installed (cookie setup deferred to Story 2.1)
- [ ] Node.js 20+ enforced via `.nvmrc` and `package.json` engines
- [ ] snake_case pass-through convention established (no camelCase conversion for DB data)
- [ ] Project naming: `teachmesensei` (lowercase, no hyphens)
- [ ] No barrel exports — `src/lib/index.ts` is empty or removed

### Project Structure Notes

- `src/lib/index.ts`: If generated by `sv create`, empty or remove it. Project convention per `project-context.md` is direct imports only (`import { x } from '$lib/schemas/auth'`), never barrel exports (`import { x } from '$lib'`).
- `tailwind.config.ts` / `postcss.config.js`: The architecture doc's directory tree includes these but they are artifacts of Tailwind v3. Tailwind v4 uses `@tailwindcss/vite` plugin and `@theme` CSS directive. Do NOT create these files.

### References

- `_bmad-output/planning-artifacts/architecture.md` — Starter Template, Implementation Roadmap Steps 0-1, Infrastructure Decisions
- `_bmad-output/planning-artifacts/epics.md` — Epic 1, Story 1.1 acceptance criteria
- `_bmad-output/planning-artifacts/prd.md` — Technology Stack, Phase 1 Scope, NFRs
- `_bmad-output/project-context.md` — Technology Stack, Data & Naming, Architecture & Patterns
- `https://supabase.com/docs/guides/auth/server-side/sveltekit` — getAll/setAll cookie pattern
- `https://tailwindcss.com/docs/upgrade-guide` — v4 CSS-first configuration
- `https://www.shadcn-svelte.com/docs/migration/tailwind-v4` — Svelte 5 + Tailwind v4 migration

## Dev Agent Record

### Agent Model Used
Claude Opus 4.6

### Debug Log References
- `sv create` interactive addons (`--add tailwindcss`) blocked on interactive prompt — scaffolded base with `--no-add-ons` then manually configured Tailwind, ESLint, Prettier, Vitest, Playwright
- `shadcn-svelte init` required all alias flags to avoid interactive prompts
- `supabase init` v2.76.2 no longer creates `migrations/` or `seed.sql` by default — created manually
- `prettier-plugin-svelte` latest is v3.4.1 (not v4.x) — corrected package.json range

### Completion Notes List
- Scaffolded SvelteKit 2.50.2 with Svelte 5.50.0 (runes default confirmed via `$props()` in +layout.svelte)
- Tailwind v4.1.18 via `@tailwindcss/vite` — no config files, CSS-first with `@import "tailwindcss"` and `@theme` directive
- shadcn-svelte 1.1.1 initialized with OKLCH colors, tw-animate-css, zinc base color
- Supabase packages: supabase-js@2.95.3, ssr@0.8.0 (auth setup deferred to Story 2.1)
- adapter-node@5.5.2 configured in svelte.config.js with vitePreprocess
- ESLint 9 flat config + typescript-eslint + eslint-plugin-svelte + prettier integration
- Vitest 3.2.4 configured in vite.config.ts, basic setup test passes
- Playwright 1.58.2 configured with chromium project
- Node.js >=20 enforced via .nvmrc and package.json engines
- Barrel exports disabled in src/lib/index.ts
- Build succeeds, dev server starts without errors

### Change Log
- 2026-02-07: Story created by SM agent — ultimate context engine analysis completed
- 2026-02-07: Quality review applied — 15 improvements across all categories
- 2026-02-07: Implementation complete — all 10 tasks done, build/tests pass
- 2026-02-08: Code review (adversarial) — 7 issues found (1 HIGH, 4 MEDIUM, 2 LOW), all fixed:
  - Fixed: File List false claim `static/favicon.png` → corrected to `static/robots.txt`
  - Fixed: Prettier formatting violations in `src/app.css` and `src/lib/utils.ts`
  - Fixed: Added explicit `.env.local` entry to `.gitignore`
  - Fixed: `supabase/seed.sql` given comment header (was 0 bytes)
  - Fixed: `static/robots.txt` added to File List (was undocumented)
  - Fixed: Vitest placeholder test now imports and tests `cn()` utility
  - Fixed: `@supabase/supabase-js` version range `^2.95.0` → `^2.95.3`

### File List
- package.json (new)
- package-lock.json (new)
- svelte.config.js (new)
- vite.config.ts (new)
- tsconfig.json (new)
- .gitignore (new)
- .prettierrc (new)
- .prettierignore (new)
- .npmrc (new)
- .nvmrc (new)
- .env.example (new)
- eslint.config.js (new)
- playwright.config.ts (new)
- components.json (new)
- src/app.html (new)
- src/app.css (new)
- src/app.d.ts (new)
- src/routes/+layout.svelte (new)
- src/routes/+page.svelte (new)
- src/lib/index.ts (new — emptied per convention)
- src/lib/utils.ts (new — shadcn cn utility)
- src/lib/assets/favicon.svg (new)
- src/lib/components/ui/ (new — empty directory)
- supabase/config.toml (new)
- supabase/migrations/ (new — empty directory)
- supabase/seed.sql (new — empty)
- static/robots.txt (new)
- tests/test.ts (new — Playwright smoke test)
- src/lib/index.test.ts (new — Vitest setup verification)
